<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Sueldo Vigilador</title>

  <!-- Android barras oscuras -->
  <meta name="color-scheme" content="dark light">
  <meta name="theme-color" content="#161821" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#161821" media="(prefers-color-scheme: dark)">

  <link rel="stylesheet" href="style.css" />

  <!-- Estilos del botón flotante y modal del bot -->
  <style>
    /* ---------- Botón flotante ---------- */
    .svb-float {
      position: fixed;
      right: 14px;
      top: 42vh;               /* media altura; alejamos de botones propios */
      z-index: 1000;
      display: flex; flex-direction: column; align-items: flex-end; gap: 8px;
      user-select: none;
    }
    .svb-float .svb-bubble {
      width: 54px; height: 54px; border-radius: 50%;
      background: #1f6feb; color: #fff;
      display: grid; place-items: center;
      box-shadow: 0 10px 25px rgba(31,111,235,.35), 0 2px 6px rgba(0,0,0,.25);
      cursor: pointer;
      transform: translateZ(0);
    }
    .svb-float .svb-bubble:active { transform: scale(.98); }

    .svb-float .svb-hint {
      max-width: 220px;
      background: #fff; color: #111;
      border-radius: 14px; padding: 10px 12px; font-size: 13px;
      box-shadow: 0 10px 25px rgba(0,0,0,.18), 0 2px 6px rgba(0,0,0,.12);
      border: 1px solid rgba(0,0,0,.06);
      opacity: 0; pointer-events: none; transform: translateY(6px);
      transition: opacity .28s ease, transform .28s ease;
    }
    .svb-float .svb-hint.show { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .svb-float .svb-hint .dot {
      width: 8px; height: 8px; border-radius: 50%; background: #1f6feb; display: inline-block; margin-right: 6px;
    }

    /* ---------- Modal del bot ---------- */
    .svb-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,.45);
      backdrop-filter: blur(1.5px);
      display: none; z-index: 1100;
    }
    .svb-overlay.show { display: block; }

    .svb-card {
      position: absolute; inset: 4% max(10px, 2%) 4% max(10px, 2%);
      max-width: 920px; margin: auto; left: 0; right: 0; top: 0; bottom: 0;
      background: #0b0f16; border-radius: 22px; overflow: hidden;
      box-shadow: 0 30px 80px rgba(0,0,0,.45), 0 3px 10px rgba(0,0,0,.35);
    }
    .svb-frame { width: 100%; height: 100%; border: 0; display: block; }

    /* Botón cerrar, afuera del ángulo para no tapar el menú del bot */
    .svb-close {
      position: absolute; top: 0; right: 0;
      transform: translate(40%, -40%);
      width: 40px; height: 40px; border-radius: 50%;
      background: #111827; color: #fff; border: 2px solid #1f2937;
      box-shadow: 0 8px 18px rgba(0,0,0,.35);
      cursor: pointer; z-index: 2;
    }
    .svb-close:hover { background: #0f172a; }

    /* Ajustes móviles: subimos un poco la burbuja */
    @media (max-width: 480px) {
      .svb-float { right: 10px; top: 48vh; }
      .svb-card { inset: 6% 3%; border-radius: 20px; }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- MODAL de modo de cálculo -->
    <div class="modal show" id="modal-modo">
      <div class="modal-card">
        <div class="brand">
          <img src="https://cdn.jsdelivr.net/gh/sanavera/sueldo-vigilador-web@main/ic_launcher.png" alt="" />
          <h1>Sueldo <span>Vigilador</span></h1>
        </div>
        <p class="lead">¿Cómo querés calcular tu sueldo?</p>
        <p class="sub">Elegí la modalidad que usás para calcularlo de forma más precisa.</p>
        <div class="btn-col">
          <button id="btn-modo-dias" class="btn btn-brand">Por días trabajados</button>
          <button id="btn-modo-horas" class="btn btn-accent">Por horas trabajadas</button>
          <button id="btn-acerca" class="btn btn-ghost">Acerca de</button>
        </div>
      </div>
    </div>

    <!-- CABECERA -->
    <header class="header">
      <div class="brand">
        <img src="https://cdn.jsdelivr.net/gh/sanavera/sueldo-vigilador-web@main/ic_launcher.png" alt="" />
        <h1>Sueldo <span>Vigilador</span></h1>
      </div>
      <button id="btn-nuevo" class="chip">Nuevo cálculo</button>
    </header>

    <!-- FORMULARIOS -->
    <main class="content">
      <!-- MODO DÍAS -->
      <section id="form-dias" class="card hide">
        <div class="grid">
          <label class="field">
            <span>Días trabajados</span>
            <input id="diasTrabajados" type="number" min="0" inputmode="numeric" placeholder="Ej. 21" />
          </label>

          <label class="field">
            <span>▼ Horas por día</span>
            <select id="horasPorDia">
              <option value="12">12 horas</option>
              <option value="10">10 horas</option>
              <option value="8">8 horas</option>
            </select>
          </label>

          <label class="field">
            <span>Días feriados</span>
            <input id="diasFeriados" type="number" min="0" inputmode="numeric" placeholder="Ej. 1" />
          </label>

          <label class="field">
            <span>▼ Pago feriado</span>
            <select id="pagoFeriado">
              <option value="0">4h al 100% + 8h normal (12h)</option>
              <option value="1">12h al 100% (12h)</option>
              <option value="2">Jornada completa al 100% (8/10h)</option>
            </select>
          </label>

          <label class="field">
            <span>Años de antigüedad</span>
            <input id="aniosAnt" type="number" min="0" inputmode="numeric" placeholder="Ej. 1" />
          </label>

          <div class="checks">
            <label class="check">
              <input id="turnoNocheDias" type="checkbox" />
              <span>Turno noche</span>
            </label>
            <label class="check">
              <input id="sindicatoDias" type="checkbox" />
              <span>Sindicato</span>
            </label>
          </div>

          <label id="diasNocturnosWrap" class="field hide">
            <span>Días nocturnos</span>
            <input id="diasNocturnosDias" type="number" min="0" inputmode="numeric" placeholder="Igual a días trabajados" />
          </label>
        </div>

        <div class="cta">
          <button id="btn-calcular-dias" class="btn btn-brand">Calcular sueldo</button>
          <button id="btn-opciones" class="btn btn-accent">Opciones avanzadas</button>
        </div>

        <div id="resultado-dias" class="resultado hide">
          <div class="neto" id="neto-dias"></div>
          <div class="bruto" id="bruto-dias"></div>
          <div class="alt" id="alt-dias"></div>
          <button id="btn-detalle-dias" class="btn btn-ghost">Ver detalle completo</button>
        </div>
      </section>

      <!-- MODO HORAS -->
      <section id="form-horas" class="card hide">
        <div class="grid">
          <label class="field">
            <span>Horas totales del mes</span>
            <input id="horasTotales" type="number" min="0" inputmode="numeric" placeholder="Ej. 240" />
          </label>

          <label class="field">
            <span>Días feriados</span>
            <input id="diasFeriadosHoras" type="number" min="0" inputmode="numeric" placeholder="Ej. 1" />
          </label>

          <label class="field">
            <span>Días nocturnos</span>
            <input id="diasNocturnos" type="number" min="0" inputmode="numeric" placeholder="Ej. 20" />
          </label>

          <label class="field">
            <span>Años de antigüedad</span>
            <input id="aniosAntHoras" type="number" min="0" inputmode="numeric" placeholder="Ej. 1" />
          </label>

          <div class="checks">
            <label class="check">
              <input id="sindicatoHoras" type="checkbox" />
              <span>Sindicato</span>
            </label>
          </div>
        </div>

        <div class="cta">
          <button id="btn-calcular-horas" class="btn btn-brand">Calcular sueldo</button>
          <button id="btn-opciones-2" class="btn btn-accent">Opciones avanzadas</button>
        </div>

        <div id="resultado-horas" class="resultado hide">
          <div class="neto" id="neto-horas"></div>
          <div class="bruto" id="bruto-horas"></div>
          <button id="btn-detalle-horas" class="btn btn-ghost">Ver detalle completo</button>
        </div>
      </section>
    </main>

    <!-- MODAL Detalle -->
    <div class="modal" id="modal-detalle">
      <div class="modal-card lg">
        <pre id="detalle-pre" class="detalle"></pre>
        <div class="modal-actions">
          <button id="btn-cerrar-detalle" class="btn btn-ghost">Cerrar</button>
          <button id="btn-copiar" class="btn btn-accent">Copiar</button>
        </div>
      </div>
    </div>

    <!-- MODAL Opciones avanzadas -->
    <div class="modal" id="modal-opciones">
      <div class="modal-card">
        <h2>Opciones avanzadas</h2>
        <div class="grid">
          <!-- Spinner de Escala salarial -->
          <label class="field">
            <span>▼ Escala salarial</span>
            <select id="escalaMes"></select>
          </label>

          <label class="field">
            <span>Horas extras desde</span>
            <select id="horasExtrasDesde">
              <option value="192">192</option>
              <option value="200">200</option>
              <option value="208" selected>208</option>
            </select>
          </label>

          <label class="field"><span>Hora normal</span><input id="vHora" type="number" step="0.01"></label>
          <label class="field"><span>Hora extra 50%</span><input id="vHora50" type="number" step="0.01"></label>
          <label class="field"><span>Hora extra 100%</span><input id="vHora100" type="number" step="0.01"></label>
          <label class="field"><span>Hora nocturna (adicional)</span><input id="vHoraNoc" type="number" step="0.01"></label>
          <label class="field"><span>Plus adicional</span><input id="plusAdi" type="number" step="0.01"></label>
          <label class="field"><span>Plus no remunerativo</span><input id="plusNR" type="number" step="0.01"></label>
          <label class="field"><span>Horas extra por jornada</span><input id="extraJornada" type="number" step="1"></label>
          <label class="field"><span>Sueldo básico</span><input id="sBasico" type="number" step="0.01"></label>
          <label class="field"><span>Presentismo</span><input id="presentismo" type="number" step="0.01"></label>
          <label class="field"><span>Viáticos</span><input id="viaticos" type="number" step="0.01"></label>
          <label class="field"><span>Horas nocturnas x día</span><input id="horasNocXD" type="number" step="1"></label>
        </div>
        <div class="modal-actions">
          <button id="btn-reset" class="btn btn-ghost">Restablecer</button>
          <div class="spacer"></div>
          <button id="btn-cancelar-opc" class="btn">Cancelar</button>
          <button id="btn-guardar-opc" class="btn btn-brand">Guardar</button>
        </div>
      </div>
    </div>

    <!-- MODAL Acerca de -->
    <div class="modal" id="modal-acerca">
      <div class="modal-card lg">
        <div class="brand" style="margin-bottom:8px">
          <img src="https://cdn.jsdelivr.net/gh/sanavera/sueldo-vigilador-web@main/ic_launcher.png" alt="" />
          <h1>Sueldo <span>Vigilador</span></h1>
        </div>

        <div style="margin:6px 0 14px; display:flex; gap:10px; align-items:center; flex-wrap:wrap">
          <strong>Desarrollador:</strong> <span>Sebastián Sanavera</span>
          <span style="opacity:.7">•</span>
          <span>Versión: <span class="chip" style="padding:4px 10px; border-radius:999px">Beta (modo prueba)</span></span>
        </div>

        <div class="card" style="margin-bottom:12px">
          <h2 style="margin:0 0 8px; font-size:18px">Código abierto</h2>
          <p class="sub" style="margin:0 0 8px">El código fuente está liberado para ver/editar/aprender:</p>
          <ul class="about-list">
            <li><a href="https://github.com/sanavera/sueldo-vigilador-web" target="_blank" rel="noopener">Repositorio en GitHub</a></li>
            <li><a href="https://sanavera.netlify.app/" target="_blank" rel="noopener">Sanavera MP3 - Otro proyecto</a></li>
          </ul>
        </div>

        <div class="card">
          <h2 style="margin:0 0 8px; font-size:18px">Fuentes de información</h2>
          <p class="sub" style="margin:0 8px 10px 0">Escalas salariales y normas consultadas:</p>
          <ul class="about-list">
            <li><a href="https://upsra.org.ar/" target="_blank" rel="noopener">UPSRA (Unión Personal de Seguridad)</a></li>
            <li><a href="https://www.lavozdelvigilador.com/" target="_blank" rel="noopener">La Voz del Vigilador</a></li>
            <li><a href="https://www.boletinoficial.gob.ar/" target="_blank" rel="noopener">Boletín Oficial de la República Argentina</a></li>
          </ul>
          <p class="sub" style="margin-top:10px">
            La app implementa: antigüedad 1% anual, extras 50%/100%, nocturnidad (0,1% del básico por hora), feriados según modalidad 12h/8-10h, y APOS 3% sobre sumas no remunerativas.
          </p>
        </div>

        <div class="modal-actions" style="margin-top:14px">
          <div class="spacer"></div>
          <button id="btn-cerrar-acerca" class="btn btn-brand">Entendido</button>
        </div>
      </div>
    </div>

    <footer class="footer-text">Desarrollado por Sebastián Sanavera ®</footer>
  </div>

  <!-- Overlay y Card del BOT -->
  <div id="svb-overlay" class="svb-overlay" aria-hidden="true">
    <div class="svb-card" role="dialog" aria-label="Vigilador Asistente">
      <button id="svb-close" class="svb-close" title="Cerrar">✕</button>
      <iframe id="svb-frame" class="svb-frame" allow="clipboard-read; clipboard-write; microphone"></iframe>
    </div>
  </div>

  <!-- Botón flotante -->
  <div class="svb-float" id="svb-float">
    <div class="svb-hint" id="svb-hint"><span class="dot"></span>¿Querés chatear con el asistente?</div>
    <div class="svb-bubble" id="svb-open" title="Abrir asistente">💬</div>
  </div>

  <script src="app.js"></script>

  <!-- Lógica del botón flotante y modal -->
  <script>
    (function(){
      const overlay = document.getElementById('svb-overlay');
      const openBtn = document.getElementById('svb-open');
      const closeBtn = document.getElementById('svb-close');
      const hint    = document.getElementById('svb-hint');
      const frame   = document.getElementById('svb-frame');

      // URL del bot (Base64 de https://llm-chat-app-template.sanavera78.workers.dev/ )
      const BOT_B64 = "aHR0cHM6Ly9sbG0tY2hhdC1hcHAtdGVtcGxhdGUuc2FuYXZlcmE3OC53b3JrZXJzLmRldi8=";

      // Cargar iframe solo una vez al abrir (para no consumir recursos antes)
      let loaded = false;
      function ensureLoaded(){
        if(loaded) return;
        try { frame.src = atob(BOT_B64); loaded = true; } catch {}
      }

      // Mostrar y ocultar
      function openModal(){
        ensureLoaded();
        overlay.classList.add('show');
        document.body.style.overflow = 'hidden';
      }
      function closeModal(){
        overlay.classList.remove('show');
        document.body.style.overflow = '';
      }

      openBtn.addEventListener('click', openModal);
      closeBtn.addEventListener('click', closeModal);
      overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeModal(); });

      // Hint que aparece y suena, luego se esconde
      function playPop(){
        try{
          const actx = new (window.AudioContext||window.webkitAudioContext)();
          const o = actx.createOscillator(), g = actx.createGain();
          o.type = 'sine'; o.frequency.value = 880; // pop agudo
          g.gain.setValueAtTime(0.0001, actx.currentTime);
          g.gain.exponentialRampToValueAtTime(0.12, actx.currentTime + 0.03);
          g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime + 0.20);
          o.connect(g); g.connect(actx.destination); o.start(); o.stop(actx.currentTime + 0.22);
        }catch(e){}
      }
      // Mostrar a los 900ms y ocultar a los 3s
      setTimeout(()=>{ hint.classList.add('show'); playPop(); }, 900);
      setTimeout(()=> hint.classList.remove('show'), 3600);

      // Seguridad: si teclado abre/resize movemos un poco la burbuja
      window.addEventListener('resize', ()=>{
        // nada crítico; dejamos CSS hacer el trabajo
      });
    })();
  </script>
</body>
</html>
